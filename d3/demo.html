<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://d3js.org/d3.v5.js"></script>
</head>
<body>
    <h5>一个简单的柱状图</h5>
    <div id='bar-chart'></div>
    <script>
        var width = 300;  //画布的宽度
        var height = 300;   //画布的高度
        let svg = d3.select('#bar-chart') // 选择文档中的id为#bar-chart的元素
            .append('svg') //添加一个svg元素
            .attr('width', width)//设定宽度
            .attr('height', height)//设定高度
            .style('border', '1px solid #ccc') // 设置边框
        // 有了画布，接下来就可以在画布上作图了。
        // 绘制矩形, 在 SVG 中，矩形的元素标签是 rect。
        // 要注意，在 SVG 中，x 轴的正方向是水平向右，y 轴的正方向是垂直向下的。

        // 现在给出一组数据，要对此进行可视化。数据如下
        var dataset = [ 250 , 210 , 170 , 130 , 90 ];  //数据（表示矩形的宽度）
        // 为简单起见，我们直接用数值的大小来表示矩形的像素宽度（后面会说到这不是一种好方法）。然后，添加以下代码。
        var reactHeight = 25; // 每个矩形所占的像素高度(包括空白)
        svg.selectAll('rect') // 选择svg内所有的矩形
            .data(dataset)// 绑定数组
            .enter() //指定选择集的enter部分 (当数据长度大于dom长度时候)
            .append('rect')//添加足够数量的矩形元素
            .attr('x', 20)// 绘制起点x坐标
            .attr('y', function(d, i) { // 绘制起点y坐标 y点依次递增
                // console.log(d, i);
                return i * reactHeight
            })
            .attr('width', d => d) // 绘制终点x坐标 这里是数据的大小
            .attr('height', reactHeight -2)// 绘制终点y坐标 高度是固定的 但是需要留出间隙
            .attr('fill', 'steelblue') // 填充矩形背景色
        // console.log(svg);
        // 综上，当：有数据，而没有足够图形元素的时候，使用此方法可以添加足够的元素。
        // 设置值，同理
        svg.selectAll('text')
            .data(dataset)
            .enter()
            .append('text')// <text x="0" y="15" fill='yellow' stroke="red" stroke-width='1'>I love SVG</text>
             .text(d => d)
            .attr('x', (d,i) => {
                // console.log(d);
                return d + 20
            })
            .attr('y', (d, i) => i * reactHeight+ 16)
            .attr('fill', 'red')

        // 比例尺的使用
        // 比例尺是 D3 中很重要的一个概念，上面曾经提到过直接用数值的大小来代表像素不是一种好方法，本章正是要解决此问题
        // 为什么需要比例尺？
        // 上一章制作了一个柱形图，当时有一个数组：
        // var dataset = [ 250 , 210 , 170 , 130 , 90 ];
        // 绘图时，直接使用 250 给矩形的宽度赋值，即矩形的宽度就是 250 个像素。
        // 此方式非常具有局限性，如果数值过大或过小，例如：
        // var dataset_1 = [ 2.5 , 2.1 , 1.7 , 1.3 , 0.9 ];
        // var dataset_2 = [ 2500, 2100, 1700, 1300, 900 ];

        // 于是，我们需要一种计算关系，能够：
        // 将某一区域的值映射到另一区域，其大小关系不变。
        // 这就是比例尺（Scale）。

        // 线性比例尺(scaleLinear)
        // 线性比例尺，能将一个连续的区间，映射到另一区间。要解决柱形图宽度的问题，就需要线性比例尺。

        let arr = [1.2, 2.3, 0.9, 1.5, 3.3];
        let min = d3.min(arr)
        let max = d3.max(arr)
        console.log('min: ', min); // 0.9
        console.log('min: ', max); // 3.3
        // 现有要求如下：将 dataset 中最小的值，映射成 0；将最大的值，映射成 300。
        let linear = d3.scaleLinear() // 创建一个定量的线性比例尺.
            .domain([min, max]) // 定义域
            .range([0, 300]) // 值域

        // console.dir(linear);
        console.log(linear(0.9)); // 0
        console.log(linear(2.3)); // 175
        // 比例尺的定义域 domain 为：[0.9, 3.3]
        // 比例尺的值域 range 为：[0, 300]  



          






















    </script>
</body>
</html>